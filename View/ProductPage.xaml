<Page
    x:Class="Store.View.ProductPage"
    xmlns:viewModelData="using:Store.ViewModel"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    
    xmlns:local="using:Store.View"

    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:model="using:Store.Model"
    xmlns:labs="using:CommunityToolkit.Labs.WinUI"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:md="using:CommunityToolkit.Labs.WinUI.MarkdownTextBlock"

    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition/>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>

        <FlipView 
            CornerRadius="0" 
            Grid.Column="0" 
            x:Name="ImageFlipView" 
            VerticalAlignment="Stretch" 
            HorizontalAlignment="Stretch"
            ItemsSource="{x:Bind productViewModel.Pictures}">
            <FlipView.ItemTemplate>
                <DataTemplate x:DataType="x:String">

                    <Image Stretch="UniformToFill">
                        <Image.Source>
                            <BitmapImage UriSource="{x:Bind}"/>
                        </Image.Source>
                    </Image>
                    
                </DataTemplate>
            </FlipView.ItemTemplate>
        </FlipView>

        <muxc:PipsPager
            Grid.Column="0"
            HorizontalAlignment="Center"
            VerticalAlignment="Bottom"
            NumberOfPages="{x:Bind ImageFlipView.Items.Count}"
            SelectedPageIndex="{x:Bind ImageFlipView.SelectedIndex, Mode=OneWay}"
            SelectedIndexChanged="PipsPager_SelectedIndexChanged"/>

        <ScrollViewer Grid.Column="1">
            <StackPanel 
                x:Name="ProductDataContainer" 
                Padding="50, 200, 50, 0"
                Grid.Column="1" 
                Background="{StaticResource CardBackgroundFillColorDefaultBrush}"
                Spacing="12">

                <StackPanel x:Name="ProductHeader" Spacing="7">
                <TextBlock Text="{x:Bind productViewModel.Name}" Style="{StaticResource DisplayTextBlockStyle}"/>

                <StackPanel Orientation="Horizontal" Spacing="7">

                    <TextBlock 
                        Text="{x:Bind productViewModel.Category}" 
                        VerticalAlignment="Center"
                        Style="{StaticResource BodyStrongTextBlockStyle}"/>

                    <Border 
                        Background="{StaticResource CardBackgroundFillColorSecondaryBrush}" 
                        Width="2" 
                        VerticalAlignment="Stretch"/>

                    <TextBlock 
                        Text="{x:Bind productViewModel.Provider}" 
                        VerticalAlignment="Center"
                        Style="{StaticResource BodyStrongTextBlockStyle}"
                        Foreground="{StaticResource TextFillColorTertiaryBrush}"/>

                </StackPanel>

                <RatingControl 
                    x:Name="RatingViewer"
                    Value="{x:Bind productViewModel.Rating}" 
                    HorizontalAlignment="Left" 
                    VerticalAlignment="Center" 
                    IsReadOnly="True"
                    Caption="{x:Bind productViewModel.Rating}"/>

                <labs:TokenView 
                    x:Name="Tags"
                    IsWrapped="True"                              
                    SelectionMode="None"
                    ItemsSource="{x:Bind productViewModel.Tags}"/>
            </StackPanel>

                <StackPanel Spacing="7" Margin="0 12 0 12">
                    <md:MarkdownTextBlock x:Name="MarkdownTextBlock"
                                    Text="{x:Bind productViewModel.Description}"
                                    UseAutoLinks="True"
                                    UseEmphasisExtras="True"
                                    UseListExtras="True"
                                    UsePipeTables="True"
                                    UseTaskLists="True" />
                </StackPanel>

                <ListView x:Name="ProductSpecs" ItemsSource="{x:Bind productViewModel.Specs}">

                    <ListView.Header>
                        <controls:DataTable Margin="12,0,0,0">
                            <controls:DataColumn 
                                Content="Key"
                                DesiredWidth="80"/>

                            <controls:DataColumn 
                                Content="Value"
                                DesiredWidth="120"/>

                        </controls:DataTable>
                    </ListView.Header>

                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="model:Spec">
                            <controls:DataRow HorizontalAlignment="Left">
                                <TextBlock Text="{x:Bind SpecName}" Foreground="{StaticResource TextFillColorSecondaryBrush }"/>

                                <TextBlock Text="{x:Bind SpecValue}" />
                            </controls:DataRow>
                        </DataTemplate>
                    </ListView.ItemTemplate>

                    <ListView.ItemContainerStyle>
                        <Style BasedOn="{StaticResource DefaultListViewItemStyle}" TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        </Style>
                    </ListView.ItemContainerStyle>

                </ListView>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
